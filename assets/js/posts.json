<!-- 建議保留你原本的 <section id="feed"></section> 容器 -->
<section id="feed" class="feed"></section>

<script>
(async function boot(){
  const box = document.getElementById('feed');
  box.innerHTML = '載入中…';

  // 先嘗試 /assets/posts.json；404 時退回 /Bruce/assets/posts.json
  async function fetchJSON(path){
    const res = await fetch(path + '?v=' + Date.now(), { cache: 'no-store' });
    if (!res.ok) throw new Error('HTTP ' + res.status + ' at ' + path);
    return res.json();
  }

  let data;
  try {
    data = await fetchJSON('assets/posts.json');
  } catch(e1){
    try {
      data = await fetchJSON('Bruce/assets/posts.json');
    } catch(e2){
      console.error(e1, e2);
      box.innerHTML = '<p>讀取失敗（找不到 posts.json）。請確認路徑在 <code>assets/posts.json</code> 或 <code>Bruce/assets/posts.json</code>。</p>';
      return;
    }
  }

  // 兼容兩種格式：[{...}] 或 {items:[...]}
  const posts = Array.isArray(data) ? data : (data.items || []);
  if (!Array.isArray(posts)) {
    console.error('posts.json 內容不是陣列或 items 陣列：', data);
    box.innerHTML = '<p>posts.json 格式錯誤：需要陣列或 {items:[...]}</p>';
    return;
  }

  // 時間新到舊
  posts.sort((a,b)=> new Date(b.time) - new Date(a.time));

  // 簡單渲染
  const html = posts.map(p => {
    const img = p.image ? `<a href="${p.url||'#'}" target="_blank" rel="noopener">
      <img src="${p.image}" alt="" loading="lazy"></a>` : '';
    const feel = p.feeling ? `｜心情：${p.feeling}` : '';
    const place = p.place ? `｜地點：${p.place}` : '';
    const when = new Date(p.time);
    const time = isNaN(when) ? (p.time||'') : when.toLocaleString('zh-TW',{hour12:false});
    const msg = (p.message||'').replace(/(https?:\/\/[^\s]+)/g, u=>`<a href="${u}" target="_blank" rel="noopener">${u}</a>`).replace(/\n/g,'<br>');
    const link = p.url ? `<a class="link" href="${p.url}" target="_blank" rel="noopener">在 Facebook 查看</a>` : '';
    return `
      <article class="post">
        ${img}
        <div class="meta">
          <time>${time}</time>
          ${link}
        </div>
        <div class="submeta">${[feel, place].filter(Boolean).join(' ')}</div>
        <p class="msg">${msg}</p>
      </article>
    `;
  }).join('');

  box.innerHTML = html || '<p>目前沒有貼文。</p>';

  // 少量樣式（可移到你的 CSS）
  const css = `
    .feed{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;margin:16px 0}
    .post{background:#fff;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden}
    .post img{width:100%;display:block;aspect-ratio:4/3;object-fit:cover}
    .post .meta{display:flex;justify-content:space-between;gap:8px;padding:8px 12px;font-size:.875rem;color:#475569}
    .post .submeta{padding:0 12px 8px;color:#64748b;font-size:.85rem}
    .post .msg{padding:0 12px 12px;line-height:1.6}
    @media (prefers-color-scheme: dark){
      .post{background:#0b1220;border-color:#1f2937;color:#e5e7eb}
      .post .meta,.post .submeta{color:#9aa4b2}
    }`;
  const s = document.createElement('style'); s.textContent = css; document.head.appendChild(s);
})();
</script>
