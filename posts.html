<!doctype html>
<html lang="zh-Hant" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>æ–‡ç«  | æˆ‘çš„ç¶²ç«™</title>
  <link rel="icon" href="assets/img/favicon.svg" type="image/svg+xml"/>
  <link rel="stylesheet" href="assets/css/style.css"/>
  <meta name="description" content="æˆ‘çš„æ–‡ç« èˆ‡å°ˆæ¡ˆç´€éŒ„"/>
  <style>
    .post-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
    .card img{width:100%;border-radius:12px;margin-bottom:8px;aspect-ratio:4/3;object-fit:cover}
    .meta{display:flex;justify-content:space-between;align-items:center;font-size:.85rem;opacity:.8;margin-bottom:6px}
    .submeta{color:#9aa4b2;font-size:.85rem;margin-bottom:10px}
    .msg{white-space:pre-wrap;line-height:1.6;margin-bottom:12px}
    .btn{padding:6px 12px;border-radius:6px;border:1px solid #ccc;text-decoration:none;font-size:.9rem}
  </style>
</head>
<body>
  <nav class="nav">
    <div class="container wrap">
      <a class="brand" href="index.html">
        <img src="assets/img/favicon.svg" alt="logo"/>
        <b>æˆ‘çš„ç¶²ç«™</b>
      </a>
      <div class="right">
        <a href="index.html#about">é—œæ–¼</a>
        <a href="index.html#projects">å°ˆæ¡ˆ</a>
        <a href="index.html#gallery">ç›¸ç°¿</a>
        <a href="posts.html">æ–‡ç« </a>
        <a href="index.html#contact">è¯çµ¡</a>
        <button id="themeToggle" aria-label="åˆ‡æ›ä¸»é¡Œ">ğŸŒ—</button>
      </div>
    </div>
  </nav>

  <main class="container section">
    <h1 style="margin:0 0 12px">Facebook æ–‡ç« </h1>
    <div id="feed" class="post-grid"></div>
  </main>

  <script>
  async function boot(){
    const feed = document.getElementById('feed');
    feed.innerHTML = 'è¼‰å…¥ä¸­â€¦';

    // å˜—è©¦å¤šè·¯å¾‘æŠ“ JSON
    async function fetchJSON(path){
      const res = await fetch(path + '?v=' + Date.now(), { cache:'no-store' });
      if(!res.ok) throw new Error('HTTP '+res.status);
      return res.json();
    }

    let data;
    try{
      data = await fetchJSON('assets/posts.json');
    }catch(e1){
      try{
        data = await fetchJSON('Bruce/assets/posts.json');
      }catch(e2){
        feed.innerHTML = '<p>è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèª posts.json è·¯å¾‘ã€‚</p>';
        console.error(e1, e2);
        return;
      }
    }

    const posts = Array.isArray(data) ? data : (data.items||[]);
    if(!Array.isArray(posts)){
      feed.innerHTML = '<p>posts.json æ ¼å¼éŒ¯èª¤ã€‚</p>';
      console.error('posts æ ¼å¼ï¼š', data);
      return;
    }

    posts.sort((a,b)=> new Date(b.time) - new Date(a.time));

    const html = posts.map(p=>{
      const img = p.image ? `<img src="${p.image}" alt="photo" loading="lazy">` : '';
      const feel = p.feeling ? `ï½œå¿ƒæƒ…ï¼š${p.feeling}` : '';
      const place = p.place ? `ï½œåœ°é»ï¼š${p.place}` : '';
      const when = new Date(p.time);
      const time = isNaN(when)?(p.time||''):when.toLocaleString('zh-TW',{hour12:false});
      const msg = (p.message||'').replace(/\n/g,'<br>').replace(/(https?:\/\/[^\s]+)/g, u=>`<a href="${u}" target="_blank">${u}</a>`);
      const link = p.url ? `<a href="${p.url}" class="btn" target="_blank">åœ¨ Facebook æŸ¥çœ‹</a>`:'';
      return `
        <article class="card">
          ${img}
          <div class="meta"><time>${time}</time>${link}</div>
          <div class="submeta">${[feel, place].filter(Boolean).join(' ')}</div>
          <p class="msg">${msg}</p>
        </article>
      `;
    }).join('');
    feed.innerHTML = html || '<p>ç›®å‰æ²’æœ‰è²¼æ–‡ã€‚</p>';

    // ä¸»é¡Œåˆ‡æ›ä¿ç•™
    const t = localStorage.getItem('theme');
    if(t) document.documentElement.dataset.theme = t;
    document.getElementById('themeToggle').addEventListener('click',()=>{
      const dark = document.documentElement.dataset.theme!=='light';
      document.documentElement.dataset.theme = dark?'light':'dark';
      localStorage.setItem('theme',document.documentElement.dataset.theme);
    });
  }

  document.addEventListener('DOMContentLoaded',boot);
  </script>
</body>
</html>
