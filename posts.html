<!doctype html>
<html lang="zh-Hant" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>æ–‡ç«  | æˆ‘çš„ç¶²ç«™</title>
  <link rel="icon" href="assets/img/favicon.svg" type="image/svg+xml"/>
  <link rel="stylesheet" href="assets/css/style.css"/>
  <meta name="description" content="æˆ‘çš„æ–‡ç« èˆ‡å°ˆæ¡ˆç´€éŒ„"/>

  <style>
    :root {
      /* ä¾ç…§æˆªåœ–èª¿æ•´çš„æ·±è‰²ç³»é…è‰² */
      --bg-body: #0b1120;       /* æ•´é«”èƒŒæ™¯æ¥µæ·±è— */
      --bg-card: #111827;       /* å¡ç‰‡èƒŒæ™¯æ·±ç°è— */
      --bg-input: #1f2937;      /* è¼¸å…¥æ¡†èƒŒæ™¯ */
      --border: #374151;        /* é‚Šæ¡†é¡è‰² */
      --text-main: #f3f4f6;     /*ä¸»è¦æ–‡å­—ç™½ */
      --text-muted: #9ca3af;    /* æ¬¡è¦æ–‡å­—ç° */
      
      --badge-loc: #2563eb;     /* åœ°é»æ¨™ç±¤è— */
      --badge-feel: #4f46e5;    /* å¿ƒæƒ…æ¨™ç±¤ç´«è— (æˆ–æ ¹æ“šå–œå¥½èª¿æ•´) */
      --btn-primary: #1d4ed8;   /* æŒ‰éˆ•è— */
    }

    /* ====== Base ====== */
    body {
      background-color: var(--bg-body);
      color: var(--text-main);
      font-family: system-ui, -apple-system, sans-serif;
    }

    /* å…‰æ˜æ¨¡å¼è®Šæ•¸ (å‚™ç”¨ï¼Œè‹¥éœ€è¦å¯è‡ªè¡Œèª¿æ•´) */
    [data-theme="light"] body {
      --bg-body: #f9fafb;
      --bg-card: #ffffff;
      --bg-input: #ffffff;
      --border: #e5e7eb;
      --text-main: #1f2937;
      --text-muted: #6b7280;
    }

    .sep { border:none; border-top:1px solid var(--border); margin:32px 0; }

    /* ===== Toolbar ===== */
    .toolbar {
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      margin:20px 0 24px;
      align-items: center;
    }
    .toolbar .fld { display:flex; align-items:center; gap:8px; }
    .toolbar label { font-weight:500; font-size: 0.95rem; color: var(--text-muted); }
    
    /* è¼¸å…¥æ¡†æ¨£å¼ - ä»¿æˆªåœ– */
    .toolbar input[type="text"],
    .toolbar select,
    .toolbar input[type="date"] {
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background-color: var(--bg-input);
      color: var(--text-main);
      font-size: 0.9rem;
      outline: none;
      transition: border-color .2s;
    }
    .toolbar input:focus, .toolbar select:focus {
      border-color: var(--badge-loc);
    }

    .toolbar input::placeholder { color:var(--text-muted); opacity: 0.7; }
    .toolbar .help { font-size:.85rem; color:var(--text-muted); margin-left: auto; }

    /* ===== Card ===== */
    .card {
      background-color: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      transition: transform .2s, box-shadow .2s;
    }
    .card:hover {
      border-color: #4b5563;
    }
    
    .card h3 { 
      font-size: 1.25rem; 
      margin: 0 0 12px 0; 
      color: var(--text-main); 
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 16px;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .card p.preview {
      color: #d1d5db;
      line-height: 1.6;
      margin-bottom: 20px;
      font-size: 0.95rem;
    }

    /* ===== Badges ===== */
    .badge {
      display: inline-block;
      padding: 2px 10px;
      border-radius: 4px;
      font-size: 0.8rem;
      color: #fff;
      font-weight: 500;
    }
    /* åœ°é»æ¨™ç±¤ - äº®è—è‰² */
    .badge.loc { background-color: #3b82f6; }
    /* å¿ƒæƒ…æ¨™ç±¤ - é¡ä¼¼æˆªåœ–çš„æ·¡è—/é’è‰² */
    .badge.feel { background-color: #6366f1; } 

    /* ===== Buttons ===== */
    .btn {
      display: inline-flex;
      align-items: center;
      background-color: #1f2937; /* æ·±è‰²æŒ‰éˆ•åº• */
      color: #9ca3af;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px 16px;
      text-decoration: none;
      font-size: 0.9rem;
      transition: .2s;
    }
    .btn:hover {
      background-color: #374151;
      color: #fff;
    }
    /* é–±è®€å…¨æ–‡æŒ‰éˆ•ç‰¹åˆ¥æ¨£å¼ */
    .btn.read-more {
      background-color: #1e3a8a; /* æ·±è—åº• */
      color: #bfdbfe;           /* æ·ºè—å­— */
      border: 1px solid #1e40af;
    }
    .btn.read-more:hover {
      background-color: #1d4ed8;
      color: #fff;
    }

    .btn.sm {
      padding:4px 10px;
      font-size:.85rem;
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="container wrap">
      <a class="brand" href="index.html">
        <img src="assets/img/favicon.svg" alt="logo"/>
        <b>æˆ‘çš„ç¶²ç«™</b>
      </a>
      <div class="right">
        <a href="index.html#about">é—œæ–¼</a>
        <a href="index.html#projects">å°ˆæ¡ˆ</a>
        <a href="index.html#gallery">ç›¸ç°¿</a>
        <a href="posts.html">æ–‡ç« </a>
        <a href="index.html#contact">è¯çµ¡</a>
        <button id="themeToggle" aria-label="åˆ‡æ›ä¸»é¡Œ">ğŸŒ—</button>
      </div>
    </div>
  </nav>

  <main class="container section">
    <h1 id="pageTitle" style="margin:0 0 4px">æ–‡ç« </h1>

    <div id="toolbar" class="toolbar">
      <div class="fld" style="flex-grow: 1; max-width: 300px;">
        <input id="q" type="text" style="width:100%" placeholder="æœå°‹æ¨™é¡Œï¼å…§æ–‡ï¼åœ°é»ï¼å¿ƒæƒ…â€¦"/>
      </div>
      <div class="fld">
        <label for="place">åœ°é»</label>
        <select id="place"><option value="">å…¨éƒ¨</option></select>
      </div>
      <div class="fld">
        <label for="feeling">å¿ƒæƒ…</label>
        <select id="feeling"><option value="">å…¨éƒ¨</option></select>
      </div>
      <div class="fld">
        <label for="from">å¾</label>
        <input id="from" type="date"/>
      </div>
      <div class="fld">
        <label for="to">åˆ°</label>
        <input id="to" type="date"/>
      </div>
      <div class="fld">
        <label for="sort">æ’åº</label>
        <select id="sort">
          <option value="desc">æ–° â†’ èˆŠ</option>
          <option value="asc">èˆŠ â†’ æ–°</option>
        </select>
      </div>
      <span class="help">æç¤ºï¼šè¼¸å…¥é—œéµå­—æˆ–èª¿æ•´æ¢ä»¶ï¼Œåˆ—è¡¨æœƒå³æ™‚æ›´æ–°ã€‚</span>
    </div>

    <div id="list" class="grid"></div>
    <hr class="sep"/>
    <article id="viewer" class="card" style="display:none; border:none; background:transparent; padding:0;"></article>
  </main>

  <script>
  const strip = s => s?.replace(/<[^>]+>/g,'') || '';
  const fmtDate = s => {
    const d = new Date(s);
    // æ ¼å¼åŒ–æˆ 2021/02/24 çš„æ¨£å­
    return isNaN(d) ? s : d.toLocaleDateString('zh-TW',{year:'numeric',month:'2-digit',day:'2-digit'});
  };
  // ç”¢ç”Ÿä¸åŒé¡è‰²çš„ Badge
  const badge = (t, type) => `<span class="badge ${type}">${t}</span>`;
  const debounce = (fn,ms=200)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),ms)}};

  function renderList(items){
    const list = document.getElementById('list');
    if(!items.length){ list.innerHTML='<p style="opacity:.8; padding:20px">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„æ–‡ç« ã€‚</p>'; return; }
    
    list.innerHTML = items.map(p=>{
      const title = p.title || `${fmtDate(p.date)} - ${p.place||''}`;
      const preview = strip(p.html||p.message||'').slice(0, 100) + '...';
      
      // çµ„åˆ HTMLï¼šä¾ç…§æˆªåœ–æ¨£å¼
      return `
        <article class="card">
          <h3>${title}</h3>
          <div class="meta-row">
            <span>${fmtDate(p.date)}</span>
            <span>â€¢</span>
            ${p.place ? badge(p.place, 'loc') : ''}
            ${p.feeling ? badge(p.feeling, 'feel') : ''}
          </div>
          <p class="preview">${preview}</p>
          <div><a class="btn read-more" href="posts.html#${encodeURIComponent(p.id)}">é–±è®€å…¨æ–‡</a></div>
        </article>`;
    }).join('');
  }

  function renderViewer(p){
    const v=document.getElementById('viewer');
    v.style.display='block';
    const title=p.title||`${fmtDate(p.date)} - ${p.place||''}`;
    document.getElementById('pageTitle').textContent=title;
    document.title=`${title}ï½œæˆ‘çš„ç¶²ç«™`;
    const fbBtn=p.fbURL?`<p><a class="btn sm" href="${p.fbURL}" target="_blank">åœ¨ Facebook æŸ¥çœ‹ â†—</a></p>`:'';
    
    // æª¢è¦–å–®ç¯‡æ–‡ç« æ™‚ä¹Ÿå¥—ç”¨ç›¸åŒçš„ badge æ¨£å¼
    v.innerHTML=`
      <p><a class="btn" href="posts.html">â† è¿”å›åˆ—è¡¨</a></p>
      <div class="card" style="margin-top:20px">
        <h2 style="margin-top:0">${title}</h2>
        <div class="meta-row" style="margin-bottom:20px; padding-bottom:10px; border-bottom:1px solid var(--border)">
          <span>${fmtDate(p.date)}</span><span>â€¢</span>
          ${p.place ? badge(p.place, 'loc') : ''}
          ${p.feeling ? badge(p.feeling, 'feel') : ''}
        </div>
        ${fbBtn}
        <div style="line-height:1.8; font-size:1.05rem;">${p.html||''}</div>
      </div>`;
    window.scrollTo({top:0,behavior:'smooth'});
  }

  function showViewMode(){
    document.getElementById('toolbar').style.display='none';
    document.getElementById('list').style.display='none';
    document.getElementById('viewer').style.display='block';
  }
  function showListMode(){
    document.getElementById('toolbar').style.display='flex';
    document.getElementById('list').style.display='grid';
    document.getElementById('viewer').style.display='none';
    document.getElementById('pageTitle').textContent='æ–‡ç« ';
    document.title='æ–‡ç« ï½œæˆ‘çš„ç¶²ç«™';
  }

  let ALL=[],state={q:'',place:'',feeling:'',from:'',to:'',sort:'desc'};

  function applyFilters(){
    let arr=ALL.slice();
    if(state.q){
      const q=state.q.toLowerCase();
      arr=arr.filter(p=>{
        const hay=[p.title,strip(p.html||p.message||''),p.place,p.feeling].join(' ').toLowerCase();
        return hay.includes(q);
      });
    }
    if(state.place)arr=arr.filter(p=>(p.place||'')===state.place);
    if(state.feeling)arr=arr.filter(p=>(p.feeling||'')===state.feeling);
    if(state.from)arr=arr.filter(p=>(p.date||'')>=state.from);
    if(state.to)arr=arr.filter(p=>(p.date||'')<=state.to);
    arr.sort((a,b)=>state.sort==='desc'?(a.date<b.date?1:-1):(a.date>b.date?1:-1));
    renderList(arr);
  }

  function buildToolbarOptions(){
    const places=[...new Set(ALL.map(p=>p.place).filter(Boolean))].sort();
    const feelings=[...new Set(ALL.map(p=>p.feeling).filter(Boolean))].sort();
    const placeSel=document.getElementById('place');
    const feelingSel=document.getElementById('feeling');
    placeSel.innerHTML=`<option value="">å…¨éƒ¨</option>${places.map(v=>`<option>${v}</option>`).join('')}`;
    feelingSel.innerHTML=`<option value="">å…¨éƒ¨</option>${feelings.map(v=>`<option>${v}</option>`).join('')}`;
  }

  function bindToolbar(){
    const $=id=>document.getElementById(id);
    const on=(el,ev,fn)=>el.addEventListener(ev,fn);
    on($('q'),'input',debounce(e=>{state.q=e.target.value.trim();applyFilters();},200));
    on($('place'),'change',e=>{state.place=e.target.value;applyFilters();});
    on($('feeling'),'change',e=>{state.feeling=e.target.value;applyFilters();});
    on($('from'),'change',e=>{state.from=e.target.value;applyFilters();});
    on($('to'),'change',e=>{state.to=e.target.value;applyFilters();});
    on($('sort'),'change',e=>{state.sort=e.target.value;applyFilters();});
  }

  async function boot(){
    const listEl=document.getElementById('list');
    listEl.innerHTML='<p style="padding:20px; opacity:0.7">è¼‰å…¥ä¸­â€¦</p>';
    
    async function fetchJSON(path){
      const res=await fetch(path+'?v='+Date.now(),{cache:'no-store'});
      if(!res.ok)throw new Error('HTTP '+res.status);
      return res.json();
    }
    
    let raw;
    // å˜—è©¦ä¸åŒçš„è·¯å¾‘ä»¥ç¢ºä¿æœ¬åœ°æˆ– GitHub Pages éƒ½èƒ½è®€å–
    try{raw=await fetchJSON('assets/js/posts.json');}
    catch{try{raw=await fetchJSON('Bruce/assets/js/posts.json');}
      catch(e){listEl.innerHTML='<p style="padding:20px">âŒ è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèª assets/js/posts.json å­˜åœ¨ã€‚</p>';return;}
    }

    if(Array.isArray(raw)){
      ALL=raw.map(p=>({id:String(p.id),title:p.title||'',date:p.date||'',place:p.place||'',feeling:p.feeling||'',html:p.html||'',message:p.message||'',fbURL:p.fbURL||p.url||''}));
    }else if(raw&&Array.isArray(raw.items)){
      ALL=raw.items.map(p=>{
        const date=(p.time||'').slice(0,10);
        // å¦‚æœæ²’æœ‰ titleï¼Œè‡ªå‹•ç”¢ç”Ÿ title
        const displayTitle = p.title || `${fmtDate(date)} - ${p.place||'ç”Ÿæ´»ç´€éŒ„'}`;
        
        // è™•ç†å…§æ–‡é¡¯ç¤º
        let htmlContent = '';
        if(p.image) htmlContent += `<p><img src="${p.image}" alt="photo" style="max-width:100%; border-radius:8px; border:1px solid #374151"/></p>`;
        if(p.message) htmlContent += `<p>${p.message.replace(/\n/g,'<br>')}</p>`;
        
        return {
            id: String(p.id),
            title: displayTitle,
            date: date,
            place: p.place||'',
            feeling: p.feeling||'',
            html: htmlContent,
            message: p.message||'',
            fbURL: p.url||''
        };
      });
    }
    ALL.sort((a,b)=>(a.date<b.date?1:-1));
    buildToolbarOptions();
    bindToolbar();
    applyFilters();
    
    function route(){
      const h=location.hash.slice(1);
      if(!h){showListMode();return;}
      const p=ALL.find(x=>String(x.id)===decodeURIComponent(h));
      p? (showViewMode(),renderViewer(p)) : showListMode();
    }
    route();
    window.addEventListener('hashchange',route);

    // ä¸»é¡Œåˆ‡æ›é‚è¼¯
    const t=localStorage.getItem('theme');
    if(t)document.documentElement.dataset.theme=t;
    document.getElementById('themeToggle').addEventListener('click',()=>{
      const dark=document.documentElement.dataset.theme!=='light';
      document.documentElement.dataset.theme=dark?'light':'dark';
      localStorage.setItem('theme',document.documentElement.dataset.theme);
    });
  }
  document.addEventListener('DOMContentLoaded',boot);
  </script>
</body>
</html>
