<!doctype html>
<html lang="zh-Hant" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>文章 | 我的網站</title>
  <link rel="icon" href="assets/img/favicon.svg" type="image/svg+xml"/>
  <link rel="stylesheet" href="assets/css/style.css"/>
  <meta name="description" content="我的文章與專案紀錄"/>
  <style>
    .post-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
    .card img{width:100%;border-radius:12px;margin-bottom:8px;aspect-ratio:4/3;object-fit:cover}
    .meta{display:flex;justify-content:space-between;align-items:center;font-size:.85rem;opacity:.8;margin-bottom:6px}
    .submeta{color:#9aa4b2;font-size:.85rem;margin-bottom:10px}
    .msg{white-space:pre-wrap;line-height:1.6;margin-bottom:12px}
    .btn{padding:6px 12px;border-radius:6px;border:1px solid #ccc;text-decoration:none;font-size:.9rem}
  </style>
</head>
<body>
  <nav class="nav">
    <div class="container wrap">
      <a class="brand" href="index.html">
        <img src="assets/img/favicon.svg" alt="logo"/>
        <b>我的網站</b>
      </a>
      <div class="right">
        <a href="index.html#about">關於</a>
        <a href="index.html#projects">專案</a>
        <a href="index.html#gallery">相簿</a>
        <a href="posts.html">文章</a>
        <a href="index.html#contact">聯絡</a>
        <button id="themeToggle" aria-label="切換主題">🌗</button>
      </div>
    </div>
  </nav>

  <main class="container section">
    <h1 style="margin:0 0 12px">Facebook 文章</h1>
    <div id="feed" class="post-grid"></div>
  </main>

  <script>
  async function boot(){
    const feed = document.getElementById('feed');
    feed.innerHTML = '載入中…';

    // 嘗試多路徑抓 JSON
    async function fetchJSON(path){
      const res = await fetch(path + '?v=' + Date.now(), { cache:'no-store' });
      if(!res.ok) throw new Error('HTTP '+res.status);
      return res.json();
    }

    let data;
    try{
      data = await fetchJSON('assets/posts.json');
    }catch(e1){
      try{
        data = await fetchJSON('Bruce/assets/posts.json');
      }catch(e2){
        feed.innerHTML = '<p>讀取失敗，請確認 posts.json 路徑。</p>';
        console.error(e1, e2);
        return;
      }
    }

    const posts = Array.isArray(data) ? data : (data.items||[]);
    if(!Array.isArray(posts)){
      feed.innerHTML = '<p>posts.json 格式錯誤。</p>';
      console.error('posts 格式：', data);
      return;
    }

    posts.sort((a,b)=> new Date(b.time) - new Date(a.time));

    const html = posts.map(p=>{
      const img = p.image ? `<img src="${p.image}" alt="photo" loading="lazy">` : '';
      const feel = p.feeling ? `｜心情：${p.feeling}` : '';
      const place = p.place ? `｜地點：${p.place}` : '';
      const when = new Date(p.time);
      const time = isNaN(when)?(p.time||''):when.toLocaleString('zh-TW',{hour12:false});
      const msg = (p.message||'').replace(/\n/g,'<br>').replace(/(https?:\/\/[^\s]+)/g, u=>`<a href="${u}" target="_blank">${u}</a>`);
      const link = p.url ? `<a href="${p.url}" class="btn" target="_blank">在 Facebook 查看</a>`:'';
      return `
        <article class="card">
          ${img}
          <div class="meta"><time>${time}</time>${link}</div>
          <div class="submeta">${[feel, place].filter(Boolean).join(' ')}</div>
          <p class="msg">${msg}</p>
        </article>
      `;
    }).join('');
    feed.innerHTML = html || '<p>目前沒有貼文。</p>';

    // 主題切換保留
    const t = localStorage.getItem('theme');
    if(t) document.documentElement.dataset.theme = t;
    document.getElementById('themeToggle').addEventListener('click',()=>{
      const dark = document.documentElement.dataset.theme!=='light';
      document.documentElement.dataset.theme = dark?'light':'dark';
      localStorage.setItem('theme',document.documentElement.dataset.theme);
    });
  }

  document.addEventListener('DOMContentLoaded',boot);
  </script>
</body>
</html>
